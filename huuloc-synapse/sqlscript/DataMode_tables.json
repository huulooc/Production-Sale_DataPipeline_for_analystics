{
	"name": "DataMode_tables",
	"properties": {
		"content": {
			"query": "-- ============================================\n-- Dimension Tables\n-- ============================================\n\n-- DimCustomer\nCREATE OR ALTER VIEW DimCustomer AS\nSELECT \n    c.Customer_ID,\n    p.First_Name AS Customer_First_Name,\n    p.Middle_Name AS Customer_Middle_Name,\n    p.Last_Name AS Customer_Last_Name,\n    c.Email_Promotion AS Email_Promotion,\n    CASE \n        WHEN c.Person_ID IS NOT NULL THEN 'Individual'\n        ELSE 'Store'\n    END AS Customer_Type\nFROM Customer c\nLEFT JOIN Person p \n       ON c.Person_ID = p.Business_Entity_ID;\n\n\n-- DimSalesPerson\nCREATE OR ALTER VIEW DimSalesPerson AS\nSELECT \n    sp.Business_Entity_ID AS Sales_Person_ID,\n    p.First_Name AS First_Name,\n    p.Middle_Name AS Middle_Name,\n    p.Last_Name AS Last_Name,\n    sp.Sales_Quota AS Sales_Quota,\n    sp.Bonus,\n    sp.Commission_Pct AS Commission_Pct\nFROM SalesPerson sp\nJOIN Person p \n     ON sp.Business_Entity_ID = p.Business_Entity_ID;\n\n\n-- DimTerritory\nCREATE OR ALTER VIEW DimTerritory AS\nSELECT \n    st.Territory_ID,\n    st.Name AS Territory_Name,\n    st.Country_Region_Code AS Territory_Country,\n    st.[Group] AS Territory_Region\nFROM SalesTerritory st;\n\n\nCREATE OR ALTER VIEW DimTime AS\nWITH Dates AS (\n    SELECT \n        DATEADD(DAY, n - 1, '2011-01-01') AS The_Day\n    FROM (\n        SELECT TOP (1461) ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS n\n        FROM sys.objects\n    ) t\n)\nSELECT\n    CAST(DATEADD(HOUR, 12, CAST(The_Day AS DATETIME)) AS DATETIME) AS DateTime_Full,  -- Ngày + 12:00:00\n    CAST(The_Day AS DATE) AS Date_Key,                                                -- Ngày chuẩn\n    DATENAME(WEEKDAY, The_Day) AS The_Day_Name,\n    DATEPART(WEEK, The_Day) AS The_Week,\n    DATEPART(ISO_WEEK, The_Day) AS The_ISO_Week,\n    DATEPART(WEEKDAY, The_Day) AS The_Day_Of_Week,\n    DATEPART(MONTH, The_Day) AS The_Month,\n    DATENAME(MONTH, The_Day) AS The_Month_Name,\n    DATEPART(QUARTER, The_Day) AS The_Quarter,\n    DATEPART(YEAR, The_Day) AS The_Year,\n    DATEFROMPARTS(YEAR(The_Day), MONTH(The_Day), 1) AS The_First_Of_Month,\n    DATEFROMPARTS(YEAR(The_Day), 12, 31) AS The_Last_Of_Year,  -- Ngày cuối năm\n    DATEPART(DAYOFYEAR, The_Day) AS The_Day_Of_Year\nFROM Dates\nWHERE The_Day BETWEEN '2011-01-01' AND '2014-12-31';\n\n\n\n-- DimLocation\nCREATE OR ALTER VIEW DimLocation AS\nSELECT\n    l.Location_ID,\n    l.Name AS Location_Name,\n    l.CostRate AS Cost_Rate,\n    l.Availability\nFROM Location l;\n\n\n-- DimProduct\nCREATE OR ALTER VIEW DimProduct AS\nSELECT \n    p.Product_ID,\n    p.Name AS Product_Name,\n    p.MakeFlag AS Make_Flag,\n    p.Finished_Goods_Flag AS Finished_Goods_Flag,\n    p.Color AS Product_Color,\n    p.Size AS Product_Size,\n    p.Weight AS Product_Weight,\n    ps.Name AS Product_Subcategory,\n    pc.Name AS Product_Category,\n    p.Standard_Cost AS Standard_Cost,\n    p.List_Price AS List_Price,\n    p.Sell_Start_Date AS Sell_Start_Date,\n    p.Sell_End_Date AS Sell_End_Date\nFROM Product p\nLEFT JOIN ProductSubcategory ps \n       ON p.Product_Subcategory_ID = ps.Product_Subcategory_ID\nLEFT JOIN ProductCategory pc \n       ON ps.Product_Category_ID = pc.Product_Category_ID;\n\n\n-- DimScrapReason\nCREATE OR ALTER VIEW DimScrapReason AS\nSELECT \n    sr.ScrapReason_ID,\n    sr.Name AS Scrap_Reason_Name\nFROM ScrapReason sr;\n\n-- ============================================\n-- Fact Tables\n-- ============================================\n\n-- FactSalesOrder\nCREATE OR ALTER VIEW FactSalesOrder AS\nSELECT \n    soh.Sales_Order_ID AS Sales_Order_ID,\n    soh.Customer_ID,\n    soh.Sales_Person_ID AS Sales_Person_ID,\n    soh.Territory_ID,  -- mã khu vực bán hàng\n    sod.Product_ID,\n    soh.Order_Date,\n    sod.Order_Qty,\n    sod.Unit_Price,\n    sod.Unit_Price-Discount,\n    soh.Freight,\n    soh.TaxAmt,\n    (sod.OrderQty * sod.UnitPrice * (1 - sod.UnitPriceDiscount)) AS Revenue\nFROM SalesOrderHeader soh\nJOIN SalesOrderDetail sod \n     ON soh.SalesOrder_ID = sod.SalesOrder_ID;\n\n\n-- FactWorkOrder\nCREATE OR ALTER VIEW FactWorkOrder AS\nSELECT \n    wo.Work_Order_ID,\n    wo.Product_ID,\n    wo.Location_ID,  -- thêm Location_ID\n    wo.Order_Qty,\n    wo.Stocked_Qty,\n    wo.Scrapped_Qty,\n    wo.Start_Date AS Scheduled_Start_Date,\n    wo.End_Date AS Scheduled_End_Date,\n    wor.Actual_Start_Date AS Actual_Start_Date,\n    wor.Actual_End_Date AS Actual_End_Date,\n    wor.Actual_Resource_Hrs AS Actual_Resource_Hrs,\n    wor.Planned_Cost AS Planned_Cost,\n    wor.Actual_Cost AS Actual_Cost,\n    wo.Scrap_Reason_ID AS Scrap_Reason_ID\nFROM WorkOrder wo\nLEFT JOIN WorkOrderRouting wor \n       ON wo.WorkOrder_ID = wor.WorkOrder_ID;\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "good_db",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}